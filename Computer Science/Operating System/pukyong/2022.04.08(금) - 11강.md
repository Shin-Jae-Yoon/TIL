스레드 라이브러리

-   프로그래머에게 스레드를 생성하고 관리할 수 있는 기능을 제공하는 라이브러리다.
-   사용자 수준 라이브러리, 운영체제가 제공하는 커널 수준 라이브러리도 있다.

Pthreads

-   POSIX에서 개발한 스레드 모델이다.
-   스레드 생성과 동기화를 위해 제정한 표준 API다.
-   실제로 구현이 된 것은 아니고 이렇게 구현하라고 하는 명세서이다.
-   UNIX 시스템에서는 공통적으로 사용된다. (Solaris, Linux, Mac OS X)

-   sum이라는 스레드 간 공유되는 변수를 전역 변수로 선언했다.
-   스레드가 실행되면 runner 함수를 실행한다.
-   pthread_t라는 tid를 저장할 수 있는 변수를 선언했다.
-   스택의 크기, 스케줄링 정보를 포함하는 스레드의 속성도 있다.
-   atoi는 아스키 to integer이다.
-   join()은 스레드가 종료하고 join 할 때까지 기다린다는 의미이다.
-   pthread_attr_init(&attr)을 이용하여 스레드 속성값을 초기화한다.

암묵적 스레딩

-   컴파일러나 실시간 라이브러리가 병렬성을 도와준다. 프로그래머의 스레드에 관한 병렬성을 컴파일러나 실시간 라이브러리가 도와주는 것을 암묵적 스레딩이라고 한다.
-   만약, 병렬로 진행하지 않고 순차적으로 진행하기를 원하는 부분이 있다면, 그 부분은 반드시 프로그래머가 명시적으로 표현해야 한다.

스레드 풀

-   스레드가 생성되고 종료하여 마무리 작업을 할 때 시간이 많이 소요된다. 작업보다 생성하고 종료하는 데 시간이 많이 소요되면 만들 필요가 없지 않으냐. 그래서 스레드 풀은 일정 수의 스레드를 미리 만들어 놓는 것이다. 그래서 스레드를 생성하면 저 공간에 그냥 실으면 끝나는 것이다. 하드웨어의 성능에 따라서 스레드 풀을 생성한다.
-   장점은, 새로운 스레드를 생성하는 것보다 존재하는 스레드에 싣는 것이 좀 더 빠르다.
-   풀의 크기에 따라 스레드의 수가 정해진다.
-   스레드를 생성하고 종료하는 것과 실행하는 것을 분리한다.

OpenMP

-   C, C++, FORTRAN 작성된 API와 컴파일러 디렉티브의 집합이다.
-   병렬로 실행할 수 있는 지역을 명시한 것이다.
-   시스템 코어의 개수만큼 스레드를 생성한다.
-   운영체제에 명확하게 스레딩 하라는 것은 아니고 일종의 가이드라인을 제시하는 것
    Grand Central Dispatch (GCD)
-   애플에서 개발한 Mac OS나 IOS를 위한 시스템
-   개발자가 병렬로 실행될 코드 섹션을 식별할 수 있도록 해주는 런타임 라이브러리
-   캐럿(^)으로 나타낸 부분을 스레딩 해준다.
-   내가 스레드를 생성하고 join하고 이런 것을 고민하지 않아도 ^로 표시하면 해당 블록은 스레드로 구현이 된다는 것이다.
-   스레드로 만든 부분을 dispatch queue에 넣어서 스케줄링한다.
-   각 프로세스에 고유한 직렬 queue가 있는데 이걸 메인 queue라고 한다. 직렬 queue를 개인 디스패치 큐라고도 한다.
-   dispatch queue는 직렬과 병행을 둘 다 수행한다. 직렬은 sequential dispatch queue에 넣고 병행은 concurrent dispatch queue에 넣어서 실행한다.
-   직렬 큐에 넣어진 태스크는 FIFO 순서대로 제거된다.
-   병행 큐에 넣어진 태스크도 FIFO 순서대로 제거되지만 한 번에 여러 태스크가 제거되어 병렬로 실행될 수 있게 한다. 다수의 시스템 전체의 병행 큐(전역 디스패치 큐라고도 함)가 존재하며 4가지 주요 서비스 품질 클래스로 나뉜다.

스레딩 관련 문제들

-   fork() system call : fork()를 하면 프로세스가 생성되는데 이때, 기존에 있는 프로세스에 있는 스레드도 같이 생성되어야 하느냐, 혹은 프로세스만 생성되어야 하는 고민을 해야 한다. UNIX에서는 두 가지 옵션을 모두 선택할 수 있게 제공한다.
-   exec() system call : exec()는 기존에 있는 프로세스에 있는 스레드도 같이 생성되도록 하는 것을 자동으로 제공한다.
-   신호 처리 : 신호는 UNIX에서 프로세스에 어떤 이벤트가 일어났는지 알려주기 위해 사용된다. 동기식과 비동기식이 있다. 동기식은 현재 실행되고 있는 같은 프로세스에 주는 신호이고 비동기식은 다른 프로세스에 주는 신호이다. 비동기식의 예로 무한 루프 도는 것을 Ctrl + C로 강제로 종료하려고 막 신호를 보내는 것이 있다. 다른 프로세스에 신호를 보내는 것이라 시간이 걸려서 바로 종료되지 않는 것이다.
-   모든 신호는 디폴트 신호 처리기, 사용자 정의 신호 처리기 둘 중 하나에 의해 처리된다. 디폴트 처리기는 커널이 해결해주고 사용자 정의 신호 처리기는 프로그래머가 이런 신호가 오면 이런 식으로 행동하라고 정의해주는 것이다.
-   신호 처리에 관한 문제는 해당 프로세스에 여러 스레드가 있으면 이 신호를 어떤 스레드에 줘야 하는지 고민할 때 발생한다. 이때 옵션이 4가지 존재한다.

1. 신호가 적용될 스레드에 전달
2. 모든 스레드에 전달
3. 몇몇 스레드들에만 선택적으로 전달
4. 특정 스레드가 모든 신호를 전달받도록 지정

-   스레드를 취소시키는 방법 : 비동기식(async)으로 바로 취소시키는 것과 지연 취소(deferred)라고 하는 취소 점(cancellation point)까지 가고 취소시키는 방법이 있다. 지연 취소의 경우 스레드가 질서 정연하게 종료될 수 있다.
-   disabled 된 것은 종료되지 않았다는 의미다.

-   스레드-로컬 저장 장치 : 스레드만의 저장 공간을 만들 수도 있다. 원래는 프로세스 안에 있는 메모리 공간을 공유하잖아. 근데 그렇게 안 할 수 있다는 말이다. TLS(Thread-local storage)를 통해서 그렇게 할 수 있는 것이다. 정적 변수(static data)와 굉장히 흡사한 개념이다.

-   스케줄러 액티베이션 : 스레드 라이브러리와 커널의 통신 문제이다. 다대다 모델, 두 수준 모델에서 반드시 고려해야 할 문제이다. 다대다 또는 두 수준 모델을 구현하는 많은 시스템은 사용자 스레드와 커널 스레드 사이에 중간 자료구조를 둔다. 이 자료구조는 통상 경량 프로세스, LWP(Lightweight Process)라고 불린다.
