# 2022.03.24(목) - 운영체제 수업

<br>

## System Calls

<br>

**시스템 호출**은 운영체제에 의해 사용할 수 있게 된 서비스에 대한 인터페이스를 제공한다. 하드웨어에 직접 접근해야 하는 저수준 작업은 어셈블리 명령으로 작성되어야 하더라도 시스템 호출은 C와 C++ 언어로 작성된 **함수 형태**로 제공 된다.

<br>

API(Application Programming Interface)는 사용자가 프로그래밍할 때 사용하는 함수이다. 예를 들어, write() 함수를 사용하면 write() 함수가 구현된 쉘 라이브러리에 가고, 거기에서 system call을 하는 write() 함수가 또 있다. API는 보통 라이브러리(library) 형태로 제공된다.

<br>

    프로그래밍할 때 사용한 write()는 system call이 아닌 API이다.
    쉘 라이브러리에 있는 wirte()가 진짜 system call이다.
    이 system call은 운영체제에서 제공하는 것이다.

<br>

윈도우와 리눅스의 system call은 당연히 다를 것이다. 이때, 사용자로부터 입력 받아서 각각의 운영체제에 맞는 system call을 하게 해주는 API가 있다. 이것이 바로 **POSIX API**이다.

<br>

Java API도 있는데, JVM을 통해 입력받은 것을 해석하고 리눅스, 우니도우 어디에서든 소스 코드가 실행될 수 있도록 적절한 system call을 한다. 이식성이 굉장히 좋지만, 인터프리터라서 해석해야 하기에 속도가 매우 느리다는 단점이 있다.

<br>

-   연속된 시스템 호출의 예

1. 입력 파일 이름 획득
   화면에 프롬포트 출력
   입력 받아들임
2. 출력 파일 이름 획득
   화면에 프롬포트 출력
   입력 받아들임
3. 입력 파일 열기
   파일 존재하지 않을 경우, 비정상적으로 종료
4. 출력 파일 생성
   파일이 존재할 경우, 비정상적으로 종료
5. 루프
   입력 파일로부터 읽어 들임
   출력 파일에 씀
   읽기가 실패할 때까지
6. 출력 파일 닫기
7. 화면에 완료 메시지 출력
8. 정상적으로 종료

<br>

-   운영체제에 따라 시스템 호출은 달라질 수 있다. 그러면, 시스템 호출할 때 운영체제에 파라미터를 어떻게 전달하나? 일반적인 세 가지 방법이 있다.

1. 가장 간단하게, 매개변수를 레지스터 내에 전달
2. 레지스터보다 더 많은 매개변수가 있으면, 매개변수는 메모리 내의 블록이나 테이블에 저장되고, 블록의 주소가 레지스터 내에 매개변수로 전달
3. 매개변수는 프로그램에 의해 스택(stack)에 넣어질(push) 수 있고 운영체제에 의해 꺼내지(pop off)는 스택 방법을 쓸 수도 있다.

<br>

<strong>시스템 호출의 유형</strong>

-   프로세스 제어(Process Control)
    -   프로세스 생성, 프로세스 종료
    -   끝내기(end), 중지(abort)
    -   적재(load), 실행(execution)
    -   프로세스 속성 획득(get), 프로세스 속성 설정(set)
        (프로세스 중요도를 설정해서 인터럽트 받지 않게! 한 번 실행되면 중지하지 못하게)
    -   시간을 기다림
    -   이벤트를 기다림(wait event), 이벤트를 알림(signal event)
    -   메모리 할당 및 자유화
    -   오류가 발생하면 문제가 발생한 상태의 메모리 값을 Dump 해서 남겨놓는다.
    -   버그를 파악하기 위해 한 단계씩 실행하는 디버거
    -   프로세스가 자원을 공유할 때, 사용하고 있으면 다른 쪽이 사용하지 못하게 잠금장치
-   파일 조작(File Management)
    -   파일 생성(create file), 파일 삭제(delete file)
    -   열기(open), 닫기(close)
    -   읽기, 쓰기, 위치 변경(reposition)
    -   파일 속성 획득 및 설정
-   장치 관리(Device Management)
    -   장치를 요구(request devices), 장치를 방출(release devices, 장치 다 썼다고 알려줌)
    -   읽기, 쓰기, 위치 변경(reposition)
    -   장치 속성 획득 및 설정
    -   장치의 논리적 부착(attach) 또는 분리(detach)
-   정보 유지(Information maintenance)
    -   시간과 날짜의 설정과 획득
    -   시스템 데이터의 설정과 획득
    -   프로세스, 파일, 장치 속성의 획득
    -   프로세스, 파일, 장치 속성의 설정
-   통신(Communication)
    -   통신 연결의 생성, 제거
    -   메시지의 송신, 수신
    -   상태 정보 전달
    -   원격 장치의 부착(attach) 및 분리(detach)
-   보호(Protection)
    -   get file permissions
    -   set file permissions

<br>

<strong>시스템 서비스, 시스템 프로그램</strong>

-   시스템 프로그램은 프로그램의 개발이나 실행을 편리하게 하기 위한 것이다. 이게 무슨 말이냐면, 시스템 호출은 사용자 프로그램의 “요청이 있을 때” 실행되는 것이었다. 시스템 프로그램인 운영체제는 컴퓨터에 전원이 들어온 순간부터 실행되고 있다.

-   데몬이 하는 것은 운영체제 내에 존재하면서 항상 실행되는 프로그램이다. 인터페이스가 없으며 사용자가 제어하지 않고 백그라운드에서 실행되는 녀석이다. 운영체제가 실행되면서 자동으로 실행되고, 이름 뒤에 데몬을 뜻하는 d가 붙게 된다.

-   시스템 서비스는 파일 관리(조작), 상태 정보, 파일 변경, 프로그래밍 언어 지원, 프로그램 적재와 수행, 통신, 백그라운드 서비스 등 운영체제가 실행되면서 사용자 프로그램이 잘 돌아갈 수 있게 해주는 운영체제의 똘마니이다.

-   파일 관리 : 파일과 디렉터리를 생성, 삭제, 복사, 개명, 인쇄, 열거, 조작
-   상태 정보 : 시스템 상태에 관한 정보 알려줌, 성능, 로그, 디버깅 등
-   파일 변경 : 문장 편집기(text editor)를 사용 가능
-   프로그래밍 언어 지원 : 컴파일러, 어셈블러, 디버거, 인터프리터
-   프로그램 적재와 수행 : 프로그램이 어셈블되거나 컴파일된 후, 그것이 수행되려면 반드시 메모리에 적재되어야 함. 시스템은 절대 로더(absolute loader), 재배치 가능 로더, 링키지 에디터, 중첩 로더 등을 제공 가능. 고급어나 기계어를 위한 디버깅 시스템도 필요.
-   통신 : 프로세스, 사용자, 컴퓨터 간 통신 가능하게
-   백그라운드 서비스 : 우리가 볼 수 없는 운영체제 이면에서 실행되는 것이다. 컴퓨터에 전원이 들어와서 실행되기 시작하면 같이 실행되는 프로그램이다. 서비스(services), 서브 시스템(subsystems), 디먼(daemons)로 알려져 있다.

-   응용 프로그램 : 원래 응용 프로그램은 시스템 프로그램이 아니고 사용자에 의해 실행된다. 그런데 만약, 사용자가 운영체제에 컴퓨터에 전원이 들어오면 그때 실행해주세요! 하는 것이다. 그러면 운영체제도 아니고 사용자가 실시간으로 시작하는 것도 아닌 경우 이는 시스템 프로그램에 해당하기도 한다.
